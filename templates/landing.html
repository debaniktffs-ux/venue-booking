{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto py-12 px-6">
    <div class="relative">
        <!-- Abstract Decoration -->
        <div
            class="absolute -top-40 -left-20 w-[600px] h-[600px] bg-spjimr-orange/5 rounded-full blur-[150px] pointer-events-none">
        </div>
        <div
            class="absolute top-20 -right-40 w-[500px] h-[500px] bg-purple-500/5 rounded-full blur-[150px] pointer-events-none">
        </div>

        <div class="text-center mb-24 relative z-10">
            <h2 class="text-6xl font-900 text-white tracking-tight mb-4 uppercase">
                What's on <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-spjimr-orange to-orange-400">your
                    mind?</span>
            </h2>
            <p
                class="text-gray-500 font-bold uppercase tracking-[0.5em] text-[10px] bg-white/5 py-2 px-6 rounded-full inline-block border border-white/5 backdrop-blur-3xl">
                Explore Hubs â€¢ Track Campus Life â€¢ Book Now</p>
        </div>

        <!-- Hub Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-10 mb-32 relative z-10">
            <!-- Sports Card -->
            <a href="/dashboard/sports"
                class="group relative block rounded-[3rem] overflow-hidden glass hover:border-spjimr-orange/30 transition-all duration-700 transform hover:-translate-y-3">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-orange-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700">
                </div>
                <div
                    class="h-64 bg-[url('https://images.unsplash.com/photo-1541252260730-0412e8e2108e?q=80&w=800&auto=format&fit=crop')] bg-cover bg-center grayscale group-hover:grayscale-0 group-hover:scale-110 transition-all duration-1000 opacity-20">
                </div>
                <div
                    class="absolute inset-x-0 bottom-0 p-10 bg-gradient-to-t from-slate-950 via-slate-950/80 to-transparent">
                    <span
                        class="px-4 py-1.5 bg-orange-500/10 text-spjimr-orange text-[9px] font-900 rounded-full border border-orange-500/20 uppercase tracking-[0.2em] mb-4 inline-block">Sports
                        Hub</span>
                    <h3 class="text-4xl font-900 text-white mb-2 tracking-tighter">GAME ON</h3>
                    <p
                        class="text-gray-500 text-xs font-medium leading-tight opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                        Rec Centre, Squash & Outdoor Courts</p>
                </div>
            </a>

            <!-- Cultural Card -->
            <a href="/dashboard/cultural"
                class="group relative block rounded-[3rem] overflow-hidden glass hover:border-purple-500/30 transition-all duration-700 transform hover:-translate-y-3">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700">
                </div>
                <div
                    class="h-64 bg-[url('https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?q=80&w=800&auto=format&fit=crop')] bg-cover bg-center grayscale group-hover:grayscale-0 group-hover:scale-110 transition-all duration-1000 opacity-20">
                </div>
                <div
                    class="absolute inset-x-0 bottom-0 p-10 bg-gradient-to-t from-slate-950 via-slate-950/80 to-transparent">
                    <span
                        class="px-4 py-1.5 bg-purple-500/10 text-purple-400 text-[9px] font-900 rounded-full border border-purple-500/20 uppercase tracking-[0.2em] mb-4 inline-block">Cultural
                        Hub</span>
                    <h3 class="text-4xl font-900 text-white mb-2 tracking-tighter">SPOTLIGHT</h3>
                    <p
                        class="text-gray-500 text-xs font-medium leading-tight opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                        Auditoriums & Gala Stages</p>
                </div>
            </a>

            <!-- Academic Card -->
            <a href="/dashboard/academic"
                class="group relative block rounded-[3rem] overflow-hidden glass hover:border-blue-500/30 transition-all duration-700 transform hover:-translate-y-3">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700">
                </div>
                <div
                    class="h-64 bg-[url('https://images.unsplash.com/photo-1523050335456-c466432a76f2?q=80&w=800&auto=format&fit=crop')] bg-cover bg-center grayscale group-hover:grayscale-0 group-hover:scale-110 transition-all duration-1000 opacity-20">
                </div>
                <div
                    class="absolute inset-x-0 bottom-0 p-10 bg-gradient-to-t from-slate-950 via-slate-950/80 to-transparent">
                    <span
                        class="px-4 py-1.5 bg-blue-500/10 text-blue-400 text-[9px] font-900 rounded-full border border-blue-500/20 uppercase tracking-[0.2em] mb-4 inline-block">Academic
                        Hub</span>
                    <h3 class="text-4xl font-900 text-white mb-2 tracking-tighter">SUCCESS</h3>
                    <p
                        class="text-gray-500 text-xs font-medium leading-tight opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                        NCR Rooms & Class Addas</p>
                </div>
            </a>
        </div>
    </div>

    <!-- Dynamic Campus Calendar -->
    <div class="glass rounded-[3rem] p-10 relative overflow-visible border-white/5 shadow-2xl">
        <header class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-10 relative z-10">
            <div>
                <h3 class="text-2xl font-900 text-white tracking-tight">{{ month_name }} {{ year }}</h3>
                <p class="text-[8px] text-gray-500 font-900 uppercase tracking-[0.4em] mt-1">Unified Campus Schedule</p>
            </div>

            <!-- Compact Legend -->
            <div
                class="flex items-center gap-4 bg-white/[0.02] px-4 py-2 rounded-xl border border-white/5 backdrop-blur-xl">
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 rounded-full bg-spjimr-orange shadow-lg shadow-orange-500/40"></div>
                    <span class="text-[8px] font-900 text-gray-400 uppercase tracking-widest">Sports</span>
                </div>
                <div class="flex items-center gap-2 border-l border-white/10 pl-4">
                    <div class="w-1.5 h-1.5 rounded-full bg-purple-500 shadow-lg shadow-purple-500/40"></div>
                    <span class="text-[8px] font-900 text-gray-400 uppercase tracking-widest">Cultural</span>
                </div>
                <div class="flex items-center gap-2 border-l border-white/10 pl-4">
                    <div class="w-1.5 h-1.5 rounded-full bg-blue-500 shadow-lg shadow-blue-500/40"></div>
                    <span class="text-[8px] font-900 text-gray-400 uppercase tracking-widest">Academic</span>
                </div>
                <div class="flex items-center gap-2 border-l border-white/10 pl-4">
                    <div class="w-1.5 h-1.5 rounded-full bg-red-500 shadow-lg shadow-red-500/40"></div>
                    <span class="text-[8px] font-900 text-red-500 uppercase tracking-widest">Holidays</span>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-7 gap-4 relative z-10">
            {% for day_name in ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'] %}
            <div class="text-center text-[9px] font-900 uppercase tracking-[0.4em] pb-4 
                {% if day_name in ['SAT', 'SUN'] %} text-orange-400/80 {% else %} text-gray-600 {% endif %}">
                {{ day_name }}
            </div>
            {% endfor %}

            {% for week in calendar %}
            {% for day in week %}
            {% set day_idx = loop.index0 %} <!-- 0=Mon, 6=Sun in monthcalendar -->
            <div class="group relative min-h-[110px] rounded-[1.8rem] p-5 transition-all duration-300 border
                    {% if day == 0 %} bg-transparent border-transparent
                    {% elif day == today %} bg-white/5 border-white/10 ring-1 ring-white/10 shadow-lg shadow-white/5
                    {% else %} 
                        {% if day_idx >= 5 %} bg-orange-500/[0.03] border-orange-500/10 hover:bg-orange-500/[0.08] 
                        {% else %} bg-white/[0.01] border-white/5 hover:bg-white/5 {% endif %}
                    {% endif %}">

                {% if day != 0 %}
                <span class="text-xl font-900 absolute top-4 left-6 transition-colors duration-300
                        {% if day == today %} text-white 
                        {% elif day_idx >= 5 %} text-orange-300/60
                        {% else %} text-gray-400 group-hover:text-gray-300 {% endif %}">{{ day }}</span>

                <div class="mt-8 space-y-2">
                    <!-- Holiday Inline Label -->
                    {% set date_key = year ~ "-" ~ (month if month > 9 else "0" ~ month) ~ "-" ~ (day if day > 9 else
                    "0" ~ day) %}
                    {% if holidays.get(date_key) %}
                    <div class="inline-block px-1.5 py-0.5 bg-red-500/10 border border-red-500/20 rounded-md">
                        <span class="text-[7px] font-900 text-red-400 uppercase tracking-tighter">{{
                            holidays.get(date_key) }}</span>
                    </div>
                    {% endif %}

                    <!-- Monday Closure Note -->
                    {% if day_idx == 0 %}
                    <div class="pt-1">
                        <span
                            class="text-[6px] font-900 text-gray-600 uppercase tracking-tighter leading-none block opacity-60">Rec
                            Centre Closed</span>
                    </div>
                    {% endif %}

                    <!-- Booking Markers -->
                    {% if bookings_by_day.get(day) %}
                    <div class="flex flex-wrap gap-1.5 pt-2">
                        {% set shown_cats = [] %}
                        {% for b in (bookings_by_day.get(day) or [])|sort(attribute='Category') %}
                        {% if b.Category not in shown_cats %}
                        <div
                            class="w-1.5 h-1.5 rounded-full ring-1 ring-black/20
                                    {% if b.Category == 'sports' %} bg-spjimr-orange shadow-sm shadow-orange-500/50 
                                    {% elif b.Category == 'cultural' %} bg-purple-500 shadow-sm shadow-purple-500/50 
                                    {% elif b.Category == 'academic' %} bg-blue-500 shadow-sm shadow-blue-500/50 {% endif %}">
                        </div>
                        {% set _ = shown_cats.append(b.Category) %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <!-- HOVER REVEAL PANEL -->
                {% if bookings_by_day.get(day) or holidays.get(date_key) or day_idx == 0 %}
                <div
                    class="absolute left-1/2 -translate-x-1/2 bottom-[115%] mb-2 opacity-0 group-hover:opacity-100 transition-all duration-400 pointer-events-none z-[100] w-[260px]">
                    <div
                        class="glass p-5 rounded-3xl shadow-2xl border-white/10 backdrop-blur-3xl ring-1 ring-white/10">
                        <header class="mb-4 flex items-center justify-between border-b border-white/5 pb-2">
                            <span class="text-[9px] font-900 text-gray-400 uppercase tracking-widest">{{ month_name[:3]
                                }} {{ day }} ({{ ['MON','TUE','WED','THU','FRI','SAT','SUN'][day_idx] }})</span>
                            <span class="text-[8px] font-900 text-white/40">{{ (bookings_by_day.get(day) or [])|length
                                }} Event(s)</span>
                        </header>

                        <div class="space-y-3 max-h-[300px] overflow-y-auto pr-1 custom-scrollbar">
                            {% if holidays.get(date_key) %}
                            <div class="px-3 py-2 bg-red-500/10 border border-red-500/20 rounded-xl">
                                <p class="text-[10px] font-900 text-red-400 uppercase tracking-widest">ðŸŽ‰ {{
                                    holidays.get(date_key) }}</p>
                            </div>
                            {% endif %}

                            {% if day_idx == 0 %}
                            <div class="px-3 py-2 bg-gray-500/10 border border-white/5 rounded-xl">
                                <p class="text-[9px] font-900 text-gray-500 uppercase tracking-widest">ðŸš« Rec Centre
                                    Closed</p>
                                <p class="text-[7px] text-gray-600 mt-1 uppercase font-bold tracking-tighter">Sports
                                    bookings restricted</p>
                            </div>
                            {% endif %}

                            {% for b in (bookings_by_day.get(day) or []) %}
                            <div class="p-3 rounded-xl bg-white/[0.02] border border-white/5">
                                <div class="flex items-center justify-between gap-2 mb-1">
                                    <h4 class="text-[10px] font-900 text-white truncate max-w-[120px]">{{ b.Venue }}
                                    </h4>
                                    <span
                                        class="text-[7px] font-900 uppercase tracking-tighter px-2 py-0.5 rounded
                                            {% if b.Category == 'sports' %} bg-orange-500/20 text-spjimr-orange 
                                            {% elif b.Category == 'cultural' %} bg-purple-500/20 text-purple-400 
                                            {% elif b.Category == 'academic' %} bg-blue-500/20 text-blue-400 {% endif %}">
                                        {{ b.Category }}
                                    </span>
                                </div>
                                <div class="flex items-center justify-between text-[8px] font-bold text-gray-500">
                                    <span>{{ b.Requested_By }}</span>
                                    <span class="text-white/30">{{ b.Time_Slot }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endif %}
            </div>
            {% endfor %}
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .custom-scrollbar::-webkit-scrollbar {
        width: 3px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
    }
</style>
{% endblock %}